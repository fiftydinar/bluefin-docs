# GitHub User-Attachments Migration Guide

## Overview

This guide explains how to migrate GitHub user-attachment URLs to local static images in the Bluefin documentation.

## Problem

Currently, the documentation contains **102 unique GitHub user-attachment URLs** spread across docs and blog files (e.g., `https://github.com/user-attachments/assets/3bd27bb8-a76a-4e6d-be76-18f0b40c7883`). These URLs:
- Depend on GitHub's service being available
- May not work if GitHub changes their URL structure  
- Cannot be served locally or cached
- Redirect to AWS S3 which may be blocked in some environments

## Solution

Migrate all images to `static/img/user-attachments/` and update markdown files to reference local paths.

## ⚠️ Important Note

The download scripts require access to AWS S3 (github-production-user-asset-6210df.s3.amazonaws.com) where GitHub hosts user attachments. If you encounter network errors, you may need to:
- Run the scripts on a machine with unrestricted internet access
- Request access to *.s3.amazonaws.com domains
- Or manually download images using a browser

## Quick Start

### Option 1: Automated Migration (Recommended)

Run the complete migration with one command:

```bash
npm run migrate-user-attachments
```

This will:
1. Download all 102 images to `static/img/user-attachments/`
2. Replace all URLs in markdown files with local paths
3. Generate a URL mapping file for reference

### Option 2: Step-by-Step Migration

#### Step 1: Download Images

```bash
npm run download-user-attachments
# Or directly: node scripts/download-user-attachments.js
# Or use Python: python3 scripts/download-user-attachments.py
```

This script will:
- Extract all unique GitHub user-attachment URLs from `docs/` and `blog/` directories
- Download each image to `static/img/user-attachments/`
- Detect the correct file format (PNG, JPG, GIF, WebP, SVG)
- Save a URL mapping file (`url-mapping.json`) for reference

**Troubleshooting**: If downloads fail with DNS/network errors, see the "Troubleshooting" section below.

#### Step 2: Replace URLs in Markdown Files

After successfully downloading the images, run:

```bash
npm run replace-user-attachment-urls
# Or directly: node scripts/replace-user-attachment-urls.js
```

This script will:
- Find all markdown files in `docs/` and `blog/` directories
- Replace GitHub user-attachment URLs with local paths
- Report any images that couldn't be found locally
- Preserve original URLs if local images don't exist

#### Step 3: Verify the Changes

Build and serve the documentation to verify images render correctly:

```bash
npm run build
npm run serve
```

Navigate to pages with images and verify they display properly.

### 4. Commit the Changes

```bash
git add static/img/user-attachments/ docs/ blog/
git commit -m "docs: migrate GitHub user-attachments to local static images"
```

## Manual Alternative (If Scripts Fail)

If the automated scripts don't work in your environment:

1. **Download images manually**:
   - Open each GitHub user-attachment URL in a browser
   - Save the image to `static/img/user-attachments/`
   - Name the file with its UUID (e.g., `3bd27bb8-a76a-4e6d-be76-18f0b40c7883.png`)

2. **Replace URLs manually**:
   - Use find and replace in your editor
   - Find: `https://github.com/user-attachments/assets/<UUID>`
   - Replace: `/img/user-attachments/<UUID>.<ext>`

## Directory Structure

```
static/
└── img/
    └── user-attachments/
        ├── 3bd27bb8-a76a-4e6d-be76-18f0b40c7883.png
        ├── 01b99cdf-2b10-4be4-88bf-23da3a945be8.jpg
        ├── ...
        └── url-mapping.json  (generated by download script)
```

## Docusaurus Image Best Practices

Per Docusaurus documentation:
- Static assets should be placed in the `static/` directory
- Images are referenced using absolute paths from the `static/` directory (e.g., `/img/filename.png`)
- Markdown syntax: `![Alt text](/img/user-attachments/filename.png)`
- Images are automatically copied to the build output

## Troubleshooting

### Images Don't Download

**Problem**: S3 domain is blocked or network restrictions prevent downloads

**Solution**: 
- Run the script from a machine with unrestricted internet access
- Manually download images using a browser
- Check firewall/proxy settings

### Images Don't Display After Migration

**Problem**: Path is incorrect or image extension doesn't match

**Solution**:
- Verify the image file exists in `static/img/user-attachments/`
- Check the file extension matches the path in markdown
- Run `npm run build` to ensure no build errors
- Check browser console for 404 errors

### Some Images Still Use GitHub URLs

**Problem**: Images weren't downloaded or replacement script didn't run

**Solution**:
- Check the console output from the scripts for failed downloads
- Manually download missing images
- Re-run the replacement script

## Files Modified

The migration will modify files in:
- `docs/` - Documentation markdown files
- `blog/` - Blog post markdown files  
- `static/img/user-attachments/` - New directory with downloaded images

## Scripts Reference

- `scripts/download-user-attachments.js` - Downloads all GitHub user-attachment images
- `scripts/replace-user-attachment-urls.js` - Replaces URLs in markdown files

Both scripts can be run safely multiple times (idempotent).
